<nav style="--bs-breadcrumb-divider: '>';" aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="/admin">Home</a></li>
        <li class="breadcrumb-item active" aria-current="page"> User</li>
    </ol>
</nav>
<section class="userList">
    <div
        class="d-flex justify-content-between flex-wrap flex-md nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
        <h1 class="h2">Users List</h1>

    </div>
    </div>
    <div class="container">
        <div class="row my-4">
            <div class="col-lg-12">
                <div class="table-responsive">
                    <table class="table table-stripped">
                        <thead>
                            <tr>
                                <th scope="col">#</th>
                                <th scope="col">Username</th>
                                <th scope="col">Email</th>

                                <th scope="col">Status</th>
                                <th scope="col">Block/Unblock</th>

                            </tr>
                        </thead>
                        <tbody>
                            
                                <% userList.forEach((user,index )=> { %>
                                    <tr>
                                        <td>
                                            <%= index+1 %>
                                        </td>
                                        <td>
                                            <%= user.username %>
                                        </td>
                                        <td>
                                            <%= user.email %>
                                        </td>
                                        <td>
                                            <% if (user.isBlocked) { %>
                                                <span class="badge bg-danger">Blocked</span>
                                                <% } else { %>
                                                    <span class="badge bg-success"> Active</span>
                                                    <% } %>
                                        </td>
                                        <td>
                                            <% if (!user.isAdmin) { %>
                                                <% if (!user.isBlocked) { %>
                                                    <button
                                                        onclick="blockOrUnblock('<%- user._id%>','<%- user.isBlocked%>','<%- user.username%>')"
                                                        class="btn btn-sm btn-danger" id="block_unblock">block</button>
                                                    <% } else { %>
                                                        <button
                                                            onclick="blockOrUnblock('<%- user._id%>','<%- user.isBlocked%>','<%- user.username%>')"
                                                            class="btn btn-sm btn-success"
                                                            id="block_unblock">unblock</button>

                                                        <% } %>
                                                            <% } %>
                                        </td>

                                    </tr>
                                    <% }) %>

                                        
                        </tbody>
                    </table>
                </div>
            </div>
        </div>


    </div>



</section>
<script>
    const blockOrUnblock = async (userId, isBlocked, username) => {
      try {
        
            
        const confirm = await Swal.fire({
            title: "Are you sure ?",
            icon: "warning",
            text: isBlocked == 'true' ? `you want to unblock the ${userId}` : `you want block the ${userId}`,
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: isBlocked=="true"?'Yes, Unblock it' :'Yes, block it',
            cancelButtonText :'No,cancel!',
            reverseButtons:true
        })
  
            if (confirm.isConfirmed) {
             
                const response = await fetch(`/admin/userList/block-user/${userId}`, {
                    method: 'PATCH',
                    headers: {
                        'content-type': 'application/json'
                    }
                })
                if (response.ok) {
                    Swal.fire({
                        icon: "success",
                        title: "Success"
                    })
                } else {
                    Swal.fire({
                        icon: "error",
                        title: "Error",
                        text:"Something went wrong"
                    })
                }
            }
        } catch (error) {
            console.error("error :", error)
            alert("Error occured. Please try again")
        }

    }

</script>